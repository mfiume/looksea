<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>LookSea</title>
    <meta name="description" content="TODO.">
    <meta name="author" content="Marc Fiume">

    <meta name="viewport" content="width=device-width,initial-scale=1">

    <!-- CSS Reset -->
    <link rel="stylesheet" href="woodmark/css/reset.css">

    <!-- Global CSS for plugins -->
    <link rel="stylesheet" href="woodmark/css/main.css">
    <link rel="stylesheet" type="text/css" href="slide/css/component.css" />
    <link rel="stylesheet" type="text/css" href="modal/css/component.css" />

    <script src="slide/js/modernizr.custom.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="css/custom.css" />
  </head>

  <body>

    <div class="md-modal md-effect-16" id="modal-12">
      <div class="md-content">
        <h3>Modal Dialog</h3>
        <div>
          <p>This is a modal window. You can do the following things with it:</p>
          <img id="modal-image" style="width:400; max-width: 400; max-height: 400"/>
          <button class="md-close">Close me!</button>
        </div>
      </div>
    </div>

    <div id="st-container" class="st-container">
      <!-- content push wrapper -->
      <div class="st-pusher">
        <nav class="st-menu st-effect-3" id="menu-3">
          <h2 class="icon icon-lab"><img src="img/looksea-white.png"/></h2>
          <ul>
            <li><a class="icon icon-data" href="#">Trending</a></li>
            <li><a class="icon icon-data" href="#">Wardrobe</a></li>
            <li><a class="icon icon-location" href="#">Retailers</a></li>
            <li><a class="icon icon-study" href="#">Stylists</a></li>
          </ul>
        </nav>
        <div class="st-content"><!-- this is the wrapper for the content -->
          <div class="st-content-inner"><!-- extra div for emulating position:fixed of the menu -->
            <!-- Top Navigation -->
            <div class="main">
              <div id="st-trigger-effects">
                <button data-effect="st-effect-3">blah</button>
                <button id="modal-button" class="md-trigger" data-modal="modal-12" style="display:none"></button>
                <div id="main" role="main" style="max-width:900px; margin:0 auto;">
                  <ul id="tiles">
                    <!-- These are our grid blocks -->
                    <!-- End of grid blocks -->
                  </ul>
                </div>
                <footer>
                  <center>
                    <img id="loading" width="20" src="img/loader2.gif"/>
                  </center>
                </footer>
              </div>
            </div><!-- /main -->
          </div><!-- /st-content-inner -->
        </div><!-- /st-content -->
      </div><!-- /st-pusher -->
    </div><!-- /st-container -->
    <!--<div class="md-overlay"></div><!-- the overlay element -->


    <!-- include jQuery -->
    <script src="woodmark/libs/jquery.min.js"></script>

    <!-- Include the imagesLoaded plug-in -->
    <script src="woodmark/libs/jquery.imagesloaded.js"></script>

    <!-- Include the plug-in -->
    <script src="woodmark/jquery.wookmark.js"></script>

    <!-- Once the page is loaded, initalize the plug-in. -->
    <script type="text/javascript">
      (function($) {
        $('#tiles').imagesLoaded(function() {
          var handler = null;

          // Prepare layout options.
          var options = {
            autoResize: true, // This will auto-update the layout when the browser window is resized.
            container: $('#main'), // Optional, used for some extra CSS styling
            offset: 20, // Optional, the distance between grid items
            itemWidth: 210 // Optional, the width of a grid item
          };

          function applyLayout() {
            $('#tiles').imagesLoaded(function() {
              // Destroy the old handler
              if (handler.wookmarkInstance) {
                handler.wookmarkInstance.clear();
              }

              // Create a new layout handler.
              handler = $('#tiles li');
              handler.wookmark(options);
            });
          }

          var isLoadingMore = false;
          var canLoadMore = true;

          var loadPerTime = 40;
          var numLoaded = 0;

          function disableLoading() {
            canLoadMore = false;
            $('#loading').hide();
          }

          function loadMore() {
            if (!isLoadingMore && canLoadMore) {

              isLoadingMore = true;

              $.getJSON('http://localhost:8080/looksea/api/entity?limit=' + loadPerTime + "&start=" + numLoaded,
                      function(json) {
                        var num = 0;

                        if (json.entities.length === 0) {
                          disableLoading();
                          return;
                        }

                        $.each(json.entities, function(key, val) {
                          num++;
                          var img = jQuery('<img/>', {
                            src: val.entity.url,
                            width: '200'
                          });

                          $(function() {
                            img.click(function() {
                              $("#modal-image").prop('src', val.entity.url);
                              $("#modal-button" ).trigger( "click" );
                            });
                          });

                          var li = jQuery('<li>');
                          img.appendTo(li);

                          /*
                           var username = val.entity.username;
                           if (username !== '') {
                           var p = jQuery('<p/>', {
                           style: 'color: rgb(80,80,80); font-weight: bold; font-size: 11px;'
                           });
                           p.text(username);
                           p.appendTo(li);
                           }*/

                          var tagstring = val.entity.tagstring;
                          if (tagstring !== '') {
                            var p = jQuery('<p/>');
                            p.text(tagstring);
                            p.appendTo(li);
                          }

                          li.appendTo('#tiles');

                          applyLayout();
                        });

                        numLoaded += json.entities.length;
                        console.log("Loaded " + numLoaded + " in total");

                        if (json.entities.length !== loadPerTime) {

                          disableLoading();
                        }

                        isLoadingMore = false;
                      });
            }
          }

          /**
           * When scrolled all the way to the bottom, add more tiles.
           */
          function onScroll(event) {
            // Check if we're within 100 pixels of the bottom edge of the broser window.
            var winHeight = window.innerHeight ? window.innerHeight : $(window).height(); // iphone fix
            var closeToBottom = ($(window).scrollTop() + winHeight > $(document).height() - 100);

            if (closeToBottom) {
              loadMore();
            }
          }

          // Capture scroll event.
          $(window).bind('scroll', onScroll);

          // Call the layout function.
          handler = $('#tiles li');
          handler.wookmark(options);

          loadMore();
        });
      })(jQuery);
    </script>
    <script src="slide/js/classie.js"></script>
    <script src="slide/js/sidebarEffects.js"></script>

    <script src="modal/js/modalEffects.js"></script>
    <script>
      // this is important for IEs
      var polyfilter_scriptpath = '/modal/js/';
    </script>
    <script src="modal/js/cssParser.js"></script>
    <script src="modal/js/css-filters-polyfill.js"></script>
  </body>
</html>
